function affixMainMenu(){var t=$(window).scrollTop(),e=$("#mainmenu").outerHeight();0<t?$(".interact-box__wrapper").addClass("affix").css("top",t+e+"px"):$(".interact-box__wrapper").removeClass("affix")}function add2cart(t,e){var n=$(t);n.prop("disabled",!0),$.post("/my/cart/add",{id:e}).done(function(t){"error"==t?n.popover({content:"Ошибка добавления товара в корзину"}):(n.popover({placement:"bottom",content:"<h5>Добавлено</h5>Товар добавлен в корзину.<br/>Что бы ознакомится с товарами в вашей корзине,<br/>перейдите в <a href='/my/'>личный кабинет</a>.",html:!0}),n.hasClass("active")||n.text("В корзине").addClass("active"),n.popover("show"),setTimeout(function(){n.popover("dispose")},3e3))}).always(function(){n.prop("disabled",!1),updateCart()})}function setCart(t){if(t&&t.count){0==$(".cabinet-nav__count").length?$counter=$("<span>"+t.count+"</span>").addClass("cabinet-nav__count").appendTo(".cabinet-nav__cart"):$(".cabinet-nav__count").text(t.count),$(".cabinet-nav__cart").addClass("cabinet-nav__item hasItems").attr("title",t.count+" "+plural(t.count,"товар","товара","товаров"));var e=$(".cabinet-nav__count:eq(0)").clone().addClass("cabinet-nav__effect").appendTo(".cabinet-nav__cart");setTimeout(function(){e.addClass("cabinet-nav__effect--fade"),setTimeout(function(){e.remove()},1e3)},100)}}function updateCart(){$.get("/my/cart/json",function(t){t&&setCart(t)})}function scrollFunction(){50<document.body.scrollTop||20<document.documentElement.scrollTop?document.getElementById("toTopButton").style.display="block":document.getElementById("toTopButton").style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function plural(t,e,n,o){return t%10==1&&t%100!=11?e:2<=t%10&&t%10<=4&&(t%100<10||20<=t%100)?n:o}function dTokenizer(t){for(var e=[],n=t.title.length,o=1;o<=n;o++)for(var a=0;a+o<=n;a++)e.push(t.name.substr(a,o));return e}$(function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover(),$(window).on("scroll",affixMainMenu),affixMainMenu(),$("#mainmenu li.dropdown").hover(function(){$(this).find(".dropdown-menu").stop(!0,!0).delay(100).fadeIn(200)},function(){$(this).find(".dropdown-menu").stop(!0,!0).delay(100).fadeOut(200)})}),window.onscroll=function(){scrollFunction()},$(function(){var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:"/search/json/items/%QUERY"},limit:7});t.initialize();var e=new Bloodhound({datumTokenizer:dTokenizer,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:"%QUERY",url:"/search/json/categories/%QUERY"},limit:5});e.initialize(),$(".typeahead").typeahead({minLength:2,highlight:!0},{name:"items-dataset",display:"title",source:t.ttAdapter(),templates:{header:'<h3 class="tt-header">Товары</h3>',suggestion:function(t){return'<p><a href="/catalog/'+t.slug+'">'+t.title+"</a><small>"+t.articul+"</small></p>"}}},{name:"categories-dataset",display:"title",source:e.ttAdapter(),templates:{header:'<h3 class="tt-header">Разделы</h3>',suggestion:function(t){return'<p><a href="/catalog/'+t.slug+'">'+t.title+"</a></p>"}}}),$(".typeahead").bind("typeahead:select",function(t,e){console.log("Selection: ",e),window.location.href="/catalog/"+e.slug})});